---
- name: Setup | Debian | Ensure lib32(i386) is enabled.
  lineinfile:
    path: /var/lib/dpkg/arch
    regexp: "^i386"
    line: "i386"
    mode: "0644"
    create: true
  become: true
  when: setup_lib32 | bool

- name: Setup | Debian | Enable contrib repo.
  apt_repository:
    repo: deb http://deb.debian.org/debian "{{ debian_release_name }}" contrib
    state: present
  become: true
  when: setup_repo_contrib | bool

- name: Setup | Debian | Enable non-free repo.
  apt_repository:
    repo: deb http://deb.debian.org/debian "{{ debian_release_name }}" non-free
    state: present
  become: true
  when: setup_repo_nonfree | bool

- name: Setup | Debian | Enable non-free-firmware repo.
  apt_repository:
    repo: deb http://deb.debian.org/debian "{{ debian_release_name }}" non-free-firmware
    state: present
  become: true
  when: setup_repo_nonfreefirmware | bool

- name: Setup | Debian | Ensure firmware is installed.
  when: install_firmware | bool
  become: true
  apt:
    name: firmware-linux
    state: present

- name: Setup | Debian | Install non-free firmware.
  apt:
    name:
      - firmware-linux-nonfree
      - firmware-misc-nonfree
  become: true
  when: install_firmware_nonfree | bool

- name: Setup | Debian | Build essential tools.
  become: true
  apt:
    name:
      - build-essential
      - dkms
      - gettext
      - "linux-headers-{{ ansible_kernel }}"
    state: present
  when: install_build_essentials | bool

- name: Setup | Debian | Package management tools.
  become: true
  apt:
    name:
      - aptitude
      - nala
      - software-properties-common
    state: present
